// filepath: /Users/tnajaryan/work/repos/stef/stefc/templates/java/allwriterstate.java.tmpl
package {{ .PackageName }};

import net.stef.SizeLimiter;
import net.stef.WriterOptions;
import net.stef.codecs.*;
import net.stef.schema.WireSchemaIter;

public class WriterState {
    private final CommonFieldCounts structFieldCounts = new CommonFieldCounts();
    private SizeLimiter limiter;

    // Dictionaries
    {{range .Dicts -}}
    final {{.DictTypeNamePrefix}}EncoderDict {{.DictName}};
    {{end}}

    // Encoders
    {{range $name, $val := .Encoders -}}
    {{$name}}Encoder {{$name}}Encoder;
    {{end}}

    public WriterState() {
        limiter = new SizeLimiter();
        {{range .Dicts -}}
        {{.DictName}} = new {{.DictTypeNamePrefix}}EncoderDict();
        {{end}}
    }

    public void init(WriterOptions opts) {
        limiter.init(opts);
        structFieldCounts.init(opts.getSchema());

        // Init dictionaries
        {{range .Dicts -}}
        {{.DictName}}.init(limiter);
        {{end}}
    }

    public void resetDicts() {
        limiter.resetDict();
        {{range .Dicts -}}
        {{.DictName}}.reset();
        {{end}}
    }

    // Getters and setters for overrideSchema
    public CommonFieldCounts getStructFieldCounts() {
        return structFieldCounts;
    }

    public SizeLimiter getLimiter() {
        return limiter;
    }
}
